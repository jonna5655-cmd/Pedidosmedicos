<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Acceso Sistema Hospitalario</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #134e4a 100%);
            --glass-bg: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.125);
            --accent-teal: #2dd4bf;
            --text-light: #f1f5f9;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-light);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 28px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 420px;
            text-align: center;
        }

        .role-selection-wrapper {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            width: 100%;
        }

        .btn-role {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: white;
            border-radius: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            font-size: 1rem;
        }
        .btn-role:hover { 
            background: var(--accent-teal); 
            color: #0f172a; 
            transform: translateY(-2px);
        }

        .tabs { display: flex; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid var(--glass-border); }
        .tab-btn { background: none; border: none; color: white; opacity: 0.4; padding: 10px; font-weight: bold; cursor: pointer; flex: 1; }
        .tab-btn.active { opacity: 1; color: var(--accent-teal); border-bottom: 2px solid var(--accent-teal); }

        .form-section { display: none; text-align: left; }
        .form-section.active { display: block; }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.85rem; opacity: 0.8; }
        
        input, select { 
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--glass-border);
            background: rgba(0,0,0,0.3); color: white; box-sizing: border-box; outline: none;
        }
        
        input:read-only { background: rgba(255,255,255,0.05); color: var(--accent-teal); cursor: not-allowed; }

        .signature-container { background: white; border-radius: 12px; margin-top: 5px; }
        #signature-pad { width: 100%; height: 120px; touch-action: none; border-radius: 12px; }

        .btn-main {
            width: 100%; padding: 15px; background: var(--accent-teal); border: none;
            border-radius: 15px; color: #0f172a; font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="glass-card">
        
        <div id="role-menu">
            <h1 style="color: var(--accent-teal); margin-bottom: 5px;">H.Z.G.A</h1>
            <p style="opacity: 0.7; margin-bottom: 25px; font-size: 0.9rem;">Área de acceso</p>
            <div class="role-selection-wrapper">
                <button class="btn-role" onclick="selectRole('profesional')">Sector Profesional</button>
                <button class="btn-role" onclick="selectRole('camillero')">Sector Camillero</button>
                <button class="btn-role" onclick="selectRole('imagenes')">Sector Imágenes</button>
                <button class="btn-role" onclick="selectRole('jefatura')">Sector Jefatura</button>
            </div>
        </div>

        <div id="form-container" class="hidden">
            <div class="tabs">
                <button class="tab-btn active" id="tab-login" onclick="switchTab('login')">Ingresar</button>
                <button class="tab-btn" id="tab-register" onclick="switchTab('register')">Registrarse</button>
            </div>

            <div id="login-section" class="form-section active">
                <div class="input-group">
                    <label>Usuario / Email</label>
                    <input type="email" id="login-email" placeholder="usuario@hospital.com">
                </div>
                <div class="input-group">
                    <label>Contraseña</label>
                    <input type="password" id="login-pass" placeholder="••••••••">
                </div>
                <button class="btn-main" onclick="entrar()">ACCEDER</button>
                <button style="background:none; border:none; color:white; width:100%; margin-top:20px; opacity:0.5; cursor:pointer;" onclick="window.location.reload()">← Volver al inicio</button>
            </div>

            <div id="reg-prof-section" class="form-section">
                <div class="input-group">
                    <label>Foto de Perfil * (Se comprimirá automáticamente)</label>
                    <input type="file" id="p-foto" accept="image/*">
                </div>
                
                <div class="input-group"><label>Nombre y Apellido *</label><input type="text" id="p-nom"></div>
                <div class="input-group"><label>Email Institucional *</label><input type="email" id="p-mail"></div>
                <div class="input-group"><label>Contraseña *</label><input type="password" id="p-pass"></div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group"><label>DNI *</label><input type="number" id="p-dni"></div>
                    <div class="input-group"><label>Matrícula *</label><input type="number" id="p-mat"></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label>Servicio *</label>
                        <select id="p-serv">
                            <option value="Guardia Adultos">Guardia Adultos</option>
                            <option value="Guardia Pediatría">Guardia Pediatría</option>
                            <option value="Clínica Médica">Clínica Médica</option>
                            <option value="Terapia Intensiva">Terapia Intensiva</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Especialidad *</label>
                        <input type="text" id="p-esp" placeholder="Ej: Pediatra">
                    </div>
                </div>
                <div class="input-group">
                    <label>Firma Digital (Para Sello)</label>
                    <div class="signature-container"><canvas id="signature-pad"></canvas></div>
                    <button style="color:#f87171; background:none; border:none; font-size:0.7rem; float:right; cursor:pointer; padding: 5px;" onclick="clearSignature()">Borrar Firma</button>
                </div>
                <button class="btn-main" onclick="finalizarRegistro('profesional')">CREAR CUENTA</button>
            </div>

            <div id="reg-cami-section" class="form-section">
                <div class="input-group"><label>Nombre y Apellido *</label><input type="text" id="c-nom"></div>
                <div class="input-group"><label>Email *</label><input type="email" id="c-mail"></div>
                <div class="input-group"><label>Contraseña *</label><input type="password" id="c-pass"></div>
                <div class="input-group">
                    <label>Turno Laboral *</label>
                    <select id="c-turno">
                        <option value="">Seleccione...</option>
                        <option value="Mañana (07:00 - 14:00)">Mañana (07:00 - 14:00)</option>
                        <option value="Tarde (14:00 - 21:00)">Tarde (14:00 - 21:00)</option>
                        <option value="Noche (21:00 - 07:00)">Noche (21:00 - 07:00)</option>
                        <option value="Franquero (07:00 - 21:00)">Franquero (07:00 - 21:00)</option>
                    </select>
                </div>
                <button class="btn-main" onclick="finalizarRegistro('camillero')">CREAR CUENTA</button>
            </div>
        </div>
    </div>

    <script>
        let selectedRole = '';
        let canvas, ctx, drawing = false;

        function selectRole(role) {
            selectedRole = role;
            document.getElementById('role-menu').classList.add('hidden');
            document.getElementById('form-container').classList.remove('hidden');
            const emailInput = document.getElementById('login-email');
            const tabReg = document.getElementById('tab-register');

            if(role === 'imagenes') {
                emailInput.value = "imagenes@gmail.com";
                emailInput.readOnly = true;
                tabReg.style.display = 'none';
            } else if(role === 'jefatura') {
                emailInput.value = "historial@gmail.com";
                emailInput.readOnly = true;
                tabReg.style.display = 'none';
            } else {
                emailInput.value = "";
                emailInput.readOnly = false;
                tabReg.style.display = 'block';
            }
            switchTab('login');
        }

        function switchTab(mode) {
            document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(mode === 'login') {
                document.getElementById('login-section').classList.add('active');
                document.getElementById('tab-login').classList.add('active');
            } else {
                document.getElementById('tab-register').classList.add('active');
                if(selectedRole === 'profesional') {
                    document.getElementById('reg-prof-section').classList.add('active');
                    setTimeout(initSignature, 200);
                } else {
                    document.getElementById('reg-cami-section').classList.add('active');
                }
            }
        }

        function initSignature() {
            canvas = document.getElementById('signature-pad');
            if(!canvas) return;
            ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            ctx.strokeStyle = "#000"; ctx.lineWidth = 2;
            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const cx = e.touches ? e.touches[0].clientX : e.clientX;
                const cy = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: cx - rect.left, y: cy - rect.top };
            };
            canvas.addEventListener('touchstart', (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); e.preventDefault(); }, {passive: false});
            canvas.addEventListener('touchmove', (e) => { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); e.preventDefault(); }, {passive: false});
            canvas.addEventListener('touchend', () => drawing = false);
        }

        function clearSignature() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        // --- LÓGICA DE COMPRESIÓN DE IMAGEN ---
        async function procesarFoto(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvasComp = document.createElement('canvas');
                        const MAX_WIDTH = 200; // Tamaño pequeño para credencial
                        const scaleSize = MAX_WIDTH / img.width;
                        canvasComp.width = MAX_WIDTH;
                        canvasComp.height = img.height * scaleSize;
                        const ctxComp = canvasComp.getContext('2d');
                        ctxComp.drawImage(img, 0, 0, canvasComp.width, canvasComp.height);
                        // Comprimimos al 70% de calidad en formato JPEG
                        resolve(canvasComp.toDataURL('image/jpeg', 0.7));
                    };
                };
            });
        }

        async function finalizarRegistro(tipo) {
            if(tipo === 'profesional') {
                const email = document.getElementById('p-mail').value;
                const pass = document.getElementById('p-pass').value;
                const fotoInput = document.getElementById('p-foto');
                
                if(!email || !pass) return alert("Complete los campos obligatorios");

                // Guardar Foto Comprimida
                if (fotoInput.files && fotoInput.files[0]) {
                    const fotoComprimida = await procesarFoto(fotoInput.files[0]);
                    localStorage.setItem('reg-medico-foto', fotoComprimida);
                }

                localStorage.setItem('reg-medico-email', email);
                localStorage.setItem('reg-medico-pass', pass);
                localStorage.setItem('reg-medico-nombre', document.getElementById('p-nom').value);
                localStorage.setItem('reg-medico-dni', document.getElementById('p-dni').value);
                localStorage.setItem('reg-medico-mat', document.getElementById('p-mat').value);
                localStorage.setItem('reg-medico-esp', document.getElementById('p-esp').value);
                localStorage.setItem('reg-medico-serv', document.getElementById('p-serv').value);
                
                if(canvas) localStorage.setItem('user-firma', canvas.toDataURL('image/png'));
            } else {
                localStorage.setItem('reg-cami-email', document.getElementById('c-mail').value);
                localStorage.setItem('reg-cami-pass', document.getElementById('c-pass').value);
                localStorage.setItem('reg-cami-nombre', document.getElementById('c-nom').value);
                localStorage.setItem('reg-cami-turno', document.getElementById('c-turno').value);
            }
            
            alert("Registro completado con éxito.");
            switchTab('login');
        }

        function entrar() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            if(selectedRole === 'imagenes' && pass === "Imagenes26") {
                localStorage.setItem('session-imagenes', 'true');
                window.location.href = 'imagenes.html';
            }
            else if(selectedRole === 'jefatura' && pass === "Historial26") {
                localStorage.setItem('session-jefatura', 'true');
                window.location.href = 'historial.html';
            }
            else if(email === localStorage.getItem('reg-medico-email') && pass === localStorage.getItem('reg-medico-pass')) {
                window.location.href = 'medico.html';
            }
            else if(email === localStorage.getItem('reg-cami-email') && pass === localStorage.getItem('reg-cami-pass')) {
                window.location.href = 'camilleros.html';
            }
            else alert("Credenciales incorrectas.");
        }
    </script>
</body>
</html>
